\documentclass[11pt, letterpaper]{article}

\usepackage{amsmath}
\usepackage[utf8]{inputenc}
\usepackage[margin=1in]{geometry}
\usepackage{lscape}
\usepackage{mathptmx}
\usepackage[scaled=.90]{helvet}
\usepackage{courier}



\usepackage{setspace}
\usepackage{lineno} %ambos paquetes para borrado

\usepackage{graphicx}
\usepackage{longtable}
\usepackage{float}

\usepackage{siunitx} % para unidades chidas como micrometros.

\usepackage{caption}
\usepackage{subcaption}

% \doublespacing
% \linenumbers

\DeclareMathOperator{\arcsinh}{arcsinh}
\newcommand{\mum}[1]{\SI{#1}{\micro\metre}}
\newcommand{\muV}[1]{\SI{#1}{\micro\volt}}
\newcommand{\rd}{\mathrm{d}}

\newenvironment{intension}{\fontfamily{phv}\selectfont}{\par}


\author{WPK Zapfe and the Laboratorio 19 Crew}
\title{CSD, Disjoint components and trayectory detection}

\begin{document}

\maketitle

\section{Introduction}

Tracking the propagation of activity in neural tissue poses challenging
problems. 

Electro-physiological recordings usually consist of 
 series of traces, each one corresponding to a sampling
electrode on the tissue. Causality tests are made between the
signals in search for effective connections. 
As Micro Electrode Arrays (Maws) become denser,the data saturates itself
and the discovery of patterns becomes a difficult task.
Testing for combination of signals in large numbers
brings ``combinatorial explosion'' into
play. This makes the causality tests time consuming and
prone to produce false positives.
Novel information is obfuscated by the same high density acquisition that allows us to
discover it. Representing  the recorded data in ways which can unveil previously
invisible patterns is a necessity. Various techniques for separation of signals
are available now, most derived from the application of blind source
separation analysis, such as ICA.
In this paper we present a method that aims rather to integrate
the signals into functional components that
have physiological interpretation.
This is a technique for tracing out
``functional local connectivity'', which would bring independent information
that is complementary to Blind Source Separation.
Our  method would be applicable mostly to
activity in highly structured neural tissue. We shall exemplify it by
the data obtained from recordings of the rats hippocampus,
taking advantage of its highly stratified  structure. 

Local field potential (LFP)
is generated by local multi-unitary activity.
A set of simultaneous and neighbouring traces
can be regarded as representant of the action
of those multi-unitary elements. 
Successive activation  of distinct neighboring elements on structured
tissue would trace a
``trajectory'' of the activity. A tracing of such trajectories would help to indicate
causal or correlated ``functional local connections'' over the tissue. Neighboring
neurons that fire in succession, integrated sub-threshold activity and ephaptic coupling
could all be encompassed as pathways for transmission of activity. Nevertheless,
how to define and acquire the putative paths is an open question.

In previous works some form of vector averaging has been proposed and shown to reveal some trajectories drawn by the activity. We shall call such methods Center of Mass Analyses (CMA).  The ``weights'' that have been chosen for obtaining the average have been selected on heuristic grounds. In the works of Chao \emph{et al.} \cite{Chao05, Chao07}, the density of spikes in a certain time interval was used, a sort of ``averaged density of action'', while Manjarrez \emph{et al.} \cite{Manjarrez07, Manjarrez09} used the positive half of the LFP recording as their weight. 
Here we advance on such methods by incorporating mathematically sound definitions and concepts which allow us to rigorously separate spatially distinct traces. Our weight is actually the natural density function provided by the data: the Current Source Density. This representation not only provides a mathematical rigorous  measure for the weights in the vector averaging process, but helps to separate the data into disjoint sets and disconnected components.
This allows us to track separate process in the same region of interest
(r.o.i.) by following separately the distinct poles of action: influx and
efflux of charged ions, which correspond to two distinct phases of the
neuronal activity: depolarization and repolarization. 

The application of the method requires electro-physiological data acquired
through bi-dimensional MEAs, although the extension to three dimensional arrays
is straightforward.
The MEA should have dense enough spatial and temporal samplings,
so as to obtain good estimates of the CSD and their changes in time.

Our method permits us to map possible trajectories of activity inside structured neuronal tissue, without requiring ad hoc geometric constraints. As a prime example, non-convex structures which may show simultaneous activity in separate parts could show the robustness of our method. We have tested the method on slices of rat's hippocampus, concentrating in the CA3 region. We exemplify the usage of the method with data that has been obtained on experiments on rat's hippocampal slices that are centered on the GD and CA
regions. The slices are put over an array of 64 by 64 electrodes
(BioCAM 4096 by 3Brain \cite{BioCam}),
and data is recorded at sampling rates between 7 and 14 kHz. The richness of the
data is an exemplary use case for our method. A certain amount of down-scaling would be 
possible, but the array of electrodes should be at least 2 dimensional and
a inter-electrode distance of the order of magnitude of a typical pyramidal soma
(around \mum{100} at most). 




\section{Methods and Calculations}

\subsection{Prepossessing}

After acquiring data from experiment, we pass the data through some Prepossessing
routines. These serve to detect and discard unusable channels,
such as saturated or failing electrodes. The
set of failing electrodes varies from data set to data set,
as they can be produced by bubbles or by saturation after electrical stimulation
or any other cause. 
We call this step the elimination of bad channels. We use a simple criterion for this:
if the absolute value of the signal is above certain threshold (which must be
adjusted for evoked vs spontaneous activity, but
is of the order of \muV{1000}) or if the standard deviation is
larger than a two times the average r.m.s.  of the normal noise,
the channel is discarded.


\subsection{CSD for high density MEAS}

The first step is to obtain the CSD from the recorded LFP.
Any reliable method would work.
We have used two different
approaches. The first method is a  finite difference operator,
while the second is the kCSDA presented by
Potworowski \emph{et all} \cite{Potworowski2011},
which is an inverse problem approach.
Where both methods are usable, we prefer the former,
as it is faster and requires less assumptions.
We have used kCSDA where
the difference method is not applicable. The results are
independent of the method except for a multiplicative factor.
As there is still another unknown constant factor
(the resistivity of the medium) this is irrelevant.
Therefore, all of the CSD results are presented in arbitrary units.

Thanks to the density and scales of the BioCAM 4096,
the numerical finite difference method
produces an excellent approximation to the CSD,
if the number of failing channels is low or
they are outside the r.o.i.
In most examples the number  of unusable channels is in the tens.
A  numerical Laplacian Operator which reduces the cross effect of
rectangular grids is the convolution of the data with the following
matrix \cite{Lindberg90}:

\begin{equation}
\nabla^2_{1/3}=2/3
\begin{pmatrix}
  0 & 1 & 0 \\
  1 & -4 & 1 \\
  0 & 1 & 0
\end{pmatrix}
+1/3
\begin{pmatrix}
  0.5 & 0 & 0.5 \\
  0 & -2 & 0 \\
  0.5 & 0 & 0.5
\end{pmatrix}  
\end{equation}
This sort of operators are very sensitive to abrupt changes in the values.
The noise of the data can be perceived in the spatial domain as rapidly varying edges. A Gaussian spatial smoothing
can be performed before or after the Laplacian operator to the data in order to reduce excessive borders. Our Gaussian blur filter has a $ \sigma$ value of \mum{63}, which corresponds to one and a half times the inter-electrode distance.
Intuitively this means that it smooths over each structures smaller than the soma of a typical pyramidal cell. 
This is  in accordance to our mean field approach, where we expect smooth differentiable fields over the scale of the neurons, but not in finer scales (for details see \cite{Bedard11}).

On previous works it has been argued that numerical difference operators sacrifice all data on the borders of the array. For electrode arrays of lesser density, this could posse a problem, but in our case we renounce to 253 out of 4095 channels (one is grounded), and those are outside the region of interest.
If very few electrodes fail, more sophisticated methods such as iCSDA \cite{Leski2011} and kCSDA \cite{Potworowski2011} prove little advantage.
In case that around 30 or more electrodes
fail, specially if they are on the region of interest or its borders,
the use of such methods
becomes necessary. The kCSDA method relies on the
assumption that a finite family of convenient functions can span, with acceptable accuracy, a very good approximation to the  CSD at each instant in time.
A general presentation is in the reference \cite{Potworowski2011},we shall recount only the basic implementation as we used it. The
method can be summarized into two steps:
\begin{enumerate}
\item One presents a family of model functions for the CSD and
obtains the LFP that such functions
would generate.
\item Then one proceeds to calculate
  the coefficients for the entire family by projecting the
  experimental data over this ideal LFP model function family.
\end{enumerate}

We shall borrow the notation in the original paper \cite{Potworowski2011}. Our model function for the CSD is a hard disk function, described by:
\begin{equation}
  \tilde{b}_j(x,y)=\begin{cases}
  1, \text{ for } (x-x_j)^2+(y-y_j)^2 \leq R^2 \\
  0 \text{ otherwise.} 
  \end{cases}
\end{equation}
The $R$ parameter is the effective radius of the charge density, which for our
calculations was taken as half the inter-electrode distance, that is $R=$\mum{21}.
Each pair $(x_j, y_j)$ is the center of one such model function, which we take as
the position of each  functioning electrode in an adequate coordinate system.
The LFP generated by this function would then be:
\begin{equation}
  \tilde{b}_j(x,y)=\frac{1}{2\pi\sigma}
  \iint \! \rd x \rd y \arcsinh \biggr(
  \frac{2 h } {\sqrt{(x-x_j)^2+(y-y_j)^2}}
  \biggl)
  \tilde{b}_j(x,y),
\end{equation}
  with $h$ being the effective height of the function support, in our case,
  the half width of the hippocampus slice ($h=$\mum{150}).

Then the kCSDA consist of projecting the experimental data (LFP), frame by frame,
over these model functions and obtaining the  coefficients that would spawn an idealized
LFP approximation. These coefficients are the same that would produce the
corresponding CSD. The first operator is the projection operator $K$ of the experimental
LFP (from now on $V(x,y)$) on the space of the idealized LFP (which we call $V^* (x,y)$).
\begin{equation}
  K_{jk}=\sum_{l=1}^{M}b_l(x_j,y_j)b_l(x_k,y_k).
\end{equation}
The sum is done over the set of $M$ electrodes that we want to use.
The other operator is the one that maps the space of $V^*(x,y)$ into the idealized
CSD functions, now called $C^*(x,y)$. 
\begin{equation}
  \tilde{K}_{jk}=\sum_{l=1}^Mb_l(x_j,y_j)\tilde{b}_l(x_k,y_k).
\end{equation}
Then $C^*(x,y)$ can be obtained on the region of interest by:
\begin{equation}
  C^*(x_j,y_j)=\sum_{k,l=1}^M \tilde{K}_{kj} K^{-1}_{ml} V(x_l,y_l)
\end{equation}
Notice how the method incorporates a denoising mechanism, so
no smoothing filters are needed.
The great advantage of this method is that is possible to obtain a reasonable
approximation to CSD even when the presence of unusable channels is near or inside
the region of interest. The difference method, on the other hand, affects all surrounding
channels to a failing channel, up to 8 of them, so it becomes unusable if enough
saturated electrodes are over the r.o.i.

It is important to mention that our data has noise up to 0.1 of the mean magnitude of the
signal, which means that regularization of the matrix $K$ is unavoidable (see section 4.1 in \cite{Potworowski2011} and references therein). We used a regularization parameter $\lambda=0.001 |e_{max}|$, where $e_{max}$ is the principal eigenvalue of $K$. 

The attainment of $K$ and $\tilde{K}$ turns out to be computer-costly for high density MEAs, but parallelization, specially on GPUs, solves this issue.


\subsection{CSD as weight density for vectors}


Center of Mass Analysis (CMA) has been used previously in order to track putative  ``trajectories'' of the activity or information across neural tissue or even the whole brain \cite{Chao05, Chao07, Manjarrez07, Manjarrez09}. In such works the chosen ``mass'' was an heuristic measure adequate for representing the coarse-grain picture of displacement of activity. These present the problem of justifying the choice made on practical grounds. For calculating a vectorial average, the adequate weight per vector is a density, a positive quantity that measures the concentration of something per space unit, so it is only adequate that we search for a natural density in the electro-physiological experiments. The Current Source Density fits the mathematical and interpretative requirements. We shall denote it in the following as $C$ (following \cite{Potworowski2011}).  This measure is usually presented in arbitrary units, which permits us to interpret it two-fold. One, directly from its definition, as the \emph{differential divergence} of the vectorial electric current density:
\begin{equation}
  C:=\nabla \cdot J
\end{equation}
Due to conservation of charges, this is the same as as the temporal variation of density of charge:
\begin{equation}
  C=-\frac{\partial \rho}{\partial t}
\end{equation}
Current Source Density as a mathematical density (a quasi-probability density function)  allows  to rigorously apply the concepts of vector averaging. This use has been overlooked. This might have occurred because  samplings at lesser spatial resolution did not permit estimations of this quantity with enough precision to make reliable spatial implications, even with the use of sophisticated CSD estimation methods. In our case, we want to use the density as a mathematician would: a function which assigns weights to points in the space of interest and permits us to carry linear operations over them.  The space here is the sampling points of the electrodes at a given instant in time, and the weight, the CSD, is amount of interchange of charged ions from the inside to the outside of cellular membranes, per unit space.  This is an indicator of activity in the neurons, therefore the CSD is also, indirectly, a \emph{``density of local activity''}. Having both
the mathematician and electro-physiologist interpretations present we can
perform the following analysis.

Apparently, CSD would not fit the requirements of non-negativity for its use as a mathematical density. This is not a problem.  CSD separates the measured activity into three distinct sets, namely, the set of all sources, the set of all sinks and the zero set. The separation is not quantitative but qualitative: even when the signs of electric charge are arbitrary, the distinction between them is not. Therefore, CSD represents on each of the two active sets (sinks and sources) exactly what we need, a unit of concentration of changing charges per unit of space (in this case, per area), and the sign can be ignored, as long as we perform the operations in each set separately. Also, the separation by the zero value set of the CSD is in contrast to the zero value of the LFP, where it has no precise meaning as it only represents a practical reference value. This is acknowledged in most of the literature, where only the scales of the LFP recording are shown, without reference to the sign of the values. In the CSD representation,  the so called zero set (all the points in our space which have a recorded CSD of zero)  has a precise meaning: it is an instantaneous lack of activity and the border between sinks and sources. This shall be exploited further in the section below.

Once the separation into sinks and sources has been made, we would have two densities, or more precisely, two different density functions defined over two separate sets. Trying to use this for obtaining vector averages would still be crude and inexact. If these sets spread out over large non-convex areas, the vector averages could lie outside the sets, having little or none physiological interpretation. Therefore we decided to introduce another concept from geometrical sets in order to reduce the analysis to local effects.


\subsection{CSD and Disconnected Components}

A first visual inspection of the CSD color map at a given instant in time shows that both sources and sinks appear in rather large and significant patches, with typical
cross lengths around \mum{150}. .
These appear to correspond to the expected poles of firing neurons in structured tissue \cite{Buzsaki2012} and inspired us to separate the sink and source  sets into their \emph{disconnected components}. This concept is used in mathematics to denote subsets of a given geometric set that do not touch each other  \cite{Halmos}. Their rough correspondence to poles of firing neurons is most useful in tracking the successive locus of the activity.

To clarify the concept and how we are we using it an example is in order. In figure \ref{disconnectedsets} \textbf{A} we show geometrical sets enclosed by simple curves as color patches, where every color indicates a Set. The set $A$ consists of a single connected component, that means that one can make  path between any two points in the set that consist entirely of points of the same set. In contrast, the set $B$ is made of two disconnected components, labeled $B1$ and $B2$. If one chooses a point in each of the components, one cannot draw a path joining them without leaving the set. But each one of those components is connected, meaning that if we choose the pair of points in one component, then again we can trace a path joining them in the set. So the set $B$ consists of two disconnected components, but each component can be regarded as a connected set on their own. Likewise the set $C$ is made of three disconnected components. In the subfigure \ref{disconnectedsets} \textbf{Aiii} we show the center of mass of the sets. The set $A$ is concave, so, it can have a center of mass outside the set. The
set $B$ has also a center of mass outside the set. It has two disconnected components that are approximately
equal and separated by a long distance (this is not an implication: a set can be disconnected and have
a CM inside the set). For the set $C$ our approach has been used: we treat every disconnected component of the
set as an independent entity and calculate the center of mass for each one. Notice that this doesn't preclude t
he possibility of having a concave subset with a CM that lies outside. But, as we shall see,
as the electrode resolution is finite, the possibility of having highly non compact shapes is unlikely, and they
tend to have a CM inside or near their borders. In the figure \ref{disconnectedsets}
\textbf{B} we show this with experimental
data (we are using evoked activity data, as explained in section \ref{sec:evocada}). In graph
\textbf{Bi} we
separate the CSD data into the sink and sources set. We take sinks as example. In the graph
\textbf{Bii}
we label each disjoint component, obtained by a single pass algorithm. There are 25 components, and
the bigger two are non convex. In the
subfigure \textbf{Biii}
we indicate the CM of only those components that are above certain threshold of
integrated intensity (the circle size  is proportional in area to such intensity, there are five CM to be
seen). Each CM gets listed as a probable step in a trajectory.


\begin{figure}[H]
  \captionsetup{singlelinecheck=off} 
  \includegraphics[width=0.9\textwidth]{Figuras/explicadisconected.pdf}
  \caption[test]{
   %& \begingroup
    %  \fontfamily{ppl}\selectfont
    \begin{intension}
      El propósito de esta figura es aclarar los conceptos usados
      para obtener los centros de masa en componentes disconexos.
      En la parte A
      se detalla con ejemplos artificiales los conceptos de
      convexo, disjunto y disconexo, y se muestran sus
      efectos sobre el cálculo de centros de masa. En la parte B
      se encuentra una aplicación a un recuadro de datos experimentales
      para que quede claro como se ven los pasos del análisis
      en un caso real.
      La primera parte indica a grosso modo la localización
      del str. pyr. y como en un cuadro específico
      se separan los datos en los conjuntos disjuntos de Pozos y Fuentes.
      En las partes ii y iii se muestra como se separan los componentes
      disconexos y se obtienen para cada uno su centro de masa.
      \end{intension}
   %   \endgroup
      
    Explanation of the geometrical concepts used on our analysis.
    In the Row \textbf{A} of figures we show
    with an artificial example the concepts of connectedness and convexity.
    The subfigure \textbf{Ai} shows
    three sets, $A$, $B$, and $C$. $A$ fails to be convex because it is concave,
    and $C$ fails to be
    be convex because it is made of two disconnected components.
    In each of them is possible to draw a line
    connecting two points inside the set that is not entirely inside the set.
    In $B$ that is not possible, the set $B$ is convex in a mathematical sense.
    In subfigure \textbf{Aii} we made some modification to show that
    each set can be made of many disconnected components,
    and each one of them can be convex or not.  In \textbf{Aiii} we show the center of
    mass for $A$ and $B$
    taken as a whole, while for $C$ we break the set into each of the disconnected
    components and calculate each CM separately. There is no guarantee that each
    disconnected component would be convex, but as the resolution of the data is finite,
    small components are more likely to
    be convex. In figure \textbf{B} we show everything with a frame of experimental data.
    In \textbf{Bi} we separate the
    data into three sets, Sources, Sinks, and Zeros.
    We discard the Zeros and keep the active ones.
    In Figure \textbf{Bii}
    we take the Sink Set and separate it into disconnected components,
    they are labeled from one to 25 in this particular example,
    indicated by color
    For each subset we sum over its mass, and 
    considerate for the next step those who are above certain threshold. The
    next step is shown in \textbf{Biii},
    where we plot the Center of Mass for each of
    such subsets. Deviations from convexity are tolerable,
    as most of the mass is concentrated in the inner electrodes
    of each set.
  }
  \label{disconnectedsets}
\end{figure}



Theoretically, CSD would divide the set of measuring points into three subsets: the set of all sources, the set of all sinks, and the border between them.
It is impossible to define a precise zero value.
The measurements produce a function over the grid elements (the electrodes).
Noise between patches corresponding to a single set often makes bridges
between components, making identification of poles inexact.
In order to avoid this we create a ``thick neutral set'' of all the recording
points whose CSD values are inside an error interval around zero.
This separates more sharply the components of the set,
represents our ignorance of precise borders and helps
us to simplify the following analysis.

The ``thick neutral set'' would help us to separate the sinks and sources sets into
its disconnected components, which would correspond then to clear patches of
definite activity. If each one of these patches could be
interpreted as an active unit,
we may assign to it a ``center of activity'' in order to follow their displacements.
A Center of Mass for each instantaneous disconnected sink/source would provide us
a pragmatic measurement of an ``active locus''. We can then calculate at each time
frame the CM for each one of those components before tracking displacements of activity.

In each component, indexed $k$, at a given time $t$,, we have a number of points
(representing electrode centers)
with CSD of the same sign, indexed $j$. Then, the CM of the $k$-th
component would have the usual definition:
\begin{equation}\label{cmparadisj}
   \langle q(t) \rangle_k =\frac{\sum_j q_{j,k} (t) I_{j,k} (q_{j,k},t)}
           {\sum_j I(q_{j,k},t)},
\end{equation}
where $I(q_{j,k},t)$ is the CSD at point $q_{j,k}=(x_{j,k}, y_{j,k})$ at time $t$,
and the
sign of our ``density mass function'' eliminates itself graciously.
These disconnected components, while not rigorously convex,
are not largely spread over the space of the measurements.



\subsection{CM and trajectories}

We must not take out of sight the phenomena which is producing the CSD distribution:
neurons have a finite size, and the effect of their action a delimited extent.
Every patch that we can identify as a disconnected component of the Sources/Sink
sets indicates a  joint active set of units. A center of mass for each disjoint
component would then indicate an average locus for this active group, a putative center of activity to which we can give a position, intensity and time. An instantaneous snapshot of such information would depict the centers of activity of an ordered structure of neurons and their relative intensities. But it is in the successive depiction of a series of such snapshots that this analysis can show interpretative power. The appearance , displacement, and disappearance of such centers could reveal very subtle details of the dynamics of neural activity. Very small, fast displacements of the Centers of mass, may be occur due to slight asynchronous action between neurons which belong to the same active group.
Larger displacements and  longer intervals (more than two or so firing periods)
could indicate physiological connections between different groups or units.

The next step in our analysis is a procedure to systematically associate to each CM
at time $t$ a ``successor'' at time $t+\Delta t$, where $\Delta t$ is the sampling
time step. Let $q_1=(x_1, y_1)$ be the coordinates of the first point and $q_2=(x_2,y_2)$,
the corresponding coordinates of the second.
Remember that these coordinates can be now
rational numbers
respect to the grid of electrodes,
as CM are not restricted to be  at the grid points.
The distance is:
\begin{equation}
d(q_1,q_2):=\sqrt{(x_1-x_2)^2+(y_1+y_2)^2}.
\end{equation}
The integrated intensity of a CM is simply the denominator in the
eq. \ref{cmparadisj},
that is, the total ``mass'' obtained by integrating the CSD in a specific component:
\begin{equation}
  I_k(t)=\sum_j I (q_{j,k}, t).
\end{equation}
We specify then a tolerance $\delta$. If a certain $t$ a CM is below $\delta$ distance from another at $t+\Delta t$, we consider the latter the successor in time of the former. By continuously applying such procedure, we can begin to trace trajectories of the CMs, as they appear, wander, and fade. 

When a specific trajectory cannot find a successor point that is above the
threshold intensity, we assume that it has ended, so we do not concatenate
points that are separated in time by more than $\Delta t$.
In order to concatenate different
trajectories more rigorous analysis of their origin and interpretation
should is due and is beyond the scope of this work.



 \subsection{The Procedure}
 
 In order to perform the analysis described here, we summarize the steps.
 \begin{enumerate}
 \item Acquire high density electro-physiological data. The data must be two
   dimensional
   in space. Distance between the recording sites must be of the order of the typical
   size of the neurons involved or less, and such sites must be on a dense enough grid to perform numerical difference operations over them.
   The sampling frequency should be enough to detect sub-threshold activity,
   of at least 3kHz. Also, the data should come from structured tissue.
   Unordered, highly homogeneous tissue, will not yield interpretable results. 
 \item Calculate the CSD from the data. Any method may be used,
   but computer expensive techniques are discouraged if the
   number of channels is above the thousands.
   Common sense and tests are guidelines here.
   We recommend simpler, difference based approaches wherever possible.
   If many electrodes fail near the r.o.i.,
   kCSD is a good alternative if performed using
   parallel CPU or GPU computing.
   If too many electrodes are failing over the r.o.i.,
   it is better to discard the data. 
 \item Separate the CSD data into three sets: sources, sinks, and neutral.
   Again, sensible criteria have to be defined.
   A rule of thumb would be to use the mean of the peaks of the noise  of the recording as the amplitude for the ``neutral'' range of values. 
\item Perform disconnected component analysis in the sources and sinks sets, frame by frame.
  A single pass algorithm here is  adequate \cite{Vincent91, Abubaker07}.
\item  Obtain the CM for each component, using eq. \ref{cmparadisj}. Discard
  all CM that are below some significant threshold value. A rule of thumb is one tenth of the average value for all CM,
  or those who are in the lesser decil. 
\item For each frame and its successor, and for each CM, perform a ``most probable successor'' detection. Here we must put numerical criteria according to the data available, i.e. how far away and how different in intensity should be allowed a CM to be at time $t+1$ to be considered successor in time of another at time $t$.
\item ``Connect the dots'', that is, apply successively the step above for each CM, until it stops having a successor or its intensity falls below the error criteria. Then plot the successive CMs as one trajectory.
\item Plot all the trajectories and sort visually those that may have physiological interpretation from those who may be artifacts of the method. This may need some form of expert validation.
 \end{enumerate}
 

 
\section{Examples from Electro physiological data}

The necessity to create such analysis came originally from the study of
electro-physiological data obtained from the rat's hippocampus, using
a very dense MEA, the BioCAM of 3Brain \cite{BioCam}. 
The highly layered CA structure of the hippocampus provides strong, discernible patterns of Sources and Sinks. Following the paths of activity using Center of Mass analysis directly from the data, though, proves unfruitful, due to the non-convex nature of the somatic layer. Using CSD and disconnected component tracking over the data provided the right conceptual framework to follow the displacement of active areas during highly active events, such as epileptic-like activity that was pharmacological
or traumatically induced. The proposed analysis would not produce vector averages over different simultaneously active areas. On the contrary, it would separate them and track them independently. So the most violent epileptic burst provided us with the data necessary to prove the robustness of the method.
All the experimental data comes from a series of experiments
performed on slices of the rats hippocampus. 



\subsection{Application to evoked activity in the rat's hippocampus}\label{sec:evocada}

Evoked activity by electrical stimulus yields simpler and cleaner patterns in the LFP
measurements. This facilitates the exemplification of our analysis, and gives us
a good starting case. It comes at a cost, nonetheless, as many of the electrodes
remain saturated after the stimulus and well beyond the measurement interval.
The data was obtained by stimulating  specific points on the dentate gyrus
in the slice of hippocampus with different voltage intensities. Details of the experiment
have been published elsewhere \cite{Franco2018}. We shall borrow some of
the experimental data for our purposes.



%The treatment of the data is shown in figure
%\ref{CSD_Evocada01}.  The subfigure A  shows a diagram of the hippocampus, with
%the somatic layers (CA and DG) as thick black lines and the stimulus point
%shown as a blue arrow. The $a,b,c,d,e$ dots are selected electrodes for
%showing LFP and CSD traces. Those are shown in the subfigure B. In subfigure
%C the same data is presented as a spatiotemporal color map that
%shows the expected poles of firing neurons transverse to the
%pyramidal stratum.  In the subfigure D we show the CSD for a series of time frames
%over the square delimited in the subfigure A. The idea for treating the different
%patches separately becomes evident here. The sources and sinks form patches
%with an apparent anterograde movement from CA3 to CA1.
%The patches change polarity
%as expected, with the somatic layer becoming a strong sink between 3 to 4 ms
%after the stimulus, and then, at the 6 ms, inverting its polarity in a way that suggest
%successive activation of groups that are represented as movement of the patch.



The LFP is averaged over three events, produced by three successive
electrical stimuli in the same point at constant voltage. The
response of the cells is almost identical in each event, which
allows us to use averages as a denoising mechanism. After averaging
we perform kCSDA. In this case there are
many saturated electrodes and dCDSA is not viable.
In the figure \ref{lfpevocada} we show some frames of the post-stimulus
activity as a color map, along
with a diagram of the somatic layers and the
stimulus point. The saturated area is quite large, and covers
a large section of the GD structure. In this case we shall
restrict the CM track analysis to the respondent area in CA3.

In the figure \ref{trazselectevo} we show a sample of the LFP
raw traces and how they appear in the CSD representation. A diagram
over a frame of the LFP is shown delimiting the region of interest and
some selected electrodes. 

Once that we have the CSD representation, we select channels outside
the r.o.i. and use them to obtain the threshold for separating
the Sink and Sources sets. Then we proceed as stated in the previous section.

The figure \ref{lfpcsdcm}  compares the representation of the activity in
the LFP, CSD and CM spaces. The CSD
representation provides better spatial localization of active sites, and the
CM serves as better dynamical tracker. The figure illustrates
that point by choosing the time interval of response in CA3 after the stimulus.
CM representation permits us to track the activity with less
interference from the saturated region. The small, clearly localized centers of
mass separate clearly from the big patch over the saturated region.
In the figure \ref{lfpcsdcmsub} we repeat the procedure but focusing in
the r.o.i., which includes CA3 str. pyr. We take advantage of the
detailed frame to show the borders of the disconnected sets that
we have chosen for the CM analysis in the right column.


In the figure \ref{evotracks} we concatenate the successive centers of mass
for both sinks and sources and show how the anterograde reaction is
very well localized over the Pyramidal Stratum at a precise moment after
stimulus. This dataset provides us with a very clean example of the
trajectory analysis. The localized activity and coherent
action gives us trajectories that are in accordance with the expected
source and sink distribution, but adding the temporal dynamical displacement
to it. We have been very thorough with this example as it will help us
to understand the more complicated data that shall be presented in
the next examples. 

The evoked activity seems to yield much cleaner results, as we can now compare the trajectories of successive, very similar events. Our CSD and CM analysis can be used to detect consistent features in these experiments, such as the direction the waxing and waning of activity. Small deviations from the trajectory in successive experiments that are above the numerical error could indicate changes in response from
the underlying network. 


\begin{figure}[H]
  \captionsetup{singlelinecheck=off} 
  \includegraphics[width=0.9\textwidth]{Figuras/lfpevocado01.pdf}
  \caption[test]{
    \begin{intension}
      Aquí mostramos como se ve el registro crudo del potencial
      en un evento evocado. Tenmos los primeros recuadros super
      saturados, y a partir del milisegundo 4 podemos
      empezar a discernir las estructuras. Los electrodos
      más cercanos al sitio de estimulación quedan inutilizados.
      Es un ejemplo de las medidas en crudo en un caso dificil de usar.
     \end{intension}

    A set of frames showing the stimulus and posterior activity.
    The frame titled ``0 ms'' is just before the stimulus was
    made.  A diagram of the Granular and Pyramidal Layers is shown
    against the noise background. The black rectangle delimits the
    r.o.i. and the black arrow shows the site of stimulation in GD.
  }\label{lfpevocada}
\end{figure}

\begin{figure}[H]
   \centering
    \begin{subfigure}[t]{0.5\textwidth}
        \includegraphics[width=\textwidth]{Figuras/lfpcuadrodiagramaevocado.pdf}
        \caption{Select Electrodes}
        \label{fig:sel}
    \end{subfigure}
    ~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. 
      %(or a blank line to force the subfigure onto a new line)
    \begin{subfigure}[t]{0.2\textwidth}
        \includegraphics[width=\textwidth]{Figuras/lfpevocselect_3R7.pdf}
        \caption{LFP, Raw}
        \label{fig:lfpraw}
    \end{subfigure}
    ~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. 
    %(or a blank line to force the subfigure onto a new line)
    \begin{subfigure}[t]{0.2\textwidth}
        \includegraphics[width=\textwidth]{Figuras/csdevocselect_3R7.pdf}
        \caption{CSD}
        \label{fig:csd}
    \end{subfigure}
    \caption{
      \begin{intension}
        Mostremos unos cuantos trazos de la medida cruda y su representación
        en el espacio CSD, para establecer lo adecuado del experimento.
      \end{intension}
      Electrode signal across some selected electrodes over the CA3 region.
      We show in subfigure \ref{fig:sel} a frame of the raw signal in the same color
      scale as fig. \ref{lfpevocada}. The GD and CA3 structures appear as red stains,
      their general shape recognizable. In subfigure \ref{fig:lfpraw}
      the raw traces of the selected electrodes are shown, and in \ref{fig:csd} the
      csd traces come along for comparison. In this last subfigure the
      vertical scale is in arbitrary units. }
  \label{trazselectevo}
\end{figure}



\begin{figure}[H]
  \captionsetup{singlelinecheck=off} 
\includegraphics[width=0.7\textwidth]{Figuras/lfpcsdcm_completa_evocada3R7.pdf}
\caption[tu abueala]{
  \begin{intension}
    En esta imagen y la siguiente se compara la representación de
    LFP, CSD y CM. La idea es que se pueda apreciar la ventaja
    en limpieza y localización que ofrece CSD, y que se entienda
    como manejar los centros de masa a partir de aquella.
    También muestra como es posible separar la acción de un grupo
    de electrodos inservible porque su Centro de Masa no se mueve.
  \end{intension}

  Comparison of the activity represented as LFP, CSD and CM.
  The time after
  stimulation in ms is shown in the central column for each row.
  In this series of frames a relatively big patch of the electrodes
  still appear saturated, but even so the CSD shows good localization
  of the relevant deflections from the neutral or noise base signal.
  The CM representation concentrates the locus of action even more.
  The circular dots in the third column represent the center of mass
  of coherent active subsets.
}\label{lfpcsdcm}
\end{figure}



\begin{figure}[H]
   \captionsetup{singlelinecheck=off} 
   \includegraphics[width=0.7\textwidth]{Figuras/lfpcsdcm_sub_evocada3R7.pdf}
   \caption[test]{
     \begin{intension}
       Misma intensión general que la figura anterior pero en un
       recuadro específico. La idea es mostrar claramente los componentes
       disjuntos en CA3 y su Centro de Masa a detalle, en la tercera columna.
       Un punto muy claro es ver como los componentes se pueden disolver
       en componentes más pequeños.
     \end{intension}
     
     The same as previous figure, but focusing on the
  region of interest, including the stratum pyramidale of CA3. A different
  color scheme was chosen on the last column, so as to provide borders
  that show how the disconnected components where chosen. 
}\label{lfpcsdcmsub}
\end{figure}


%\begin{figure}[h]
%  \includegraphics[width=0.9\textwidth]{Figuras/CSD_EvocadaYTrazos.pdf}
%  \caption{ CSDA for evoked activity and visual inspection of disjoint
%    components. In A we present a diagram of the hippocampus slice over
%    the acquisition device. The somatic layers of CA and DG are represented as
%    thick black lines, and the stimulus site is indicated by a blue arrow. A selection
%    of six contiguous electrodes labeled $A-F$ in the r.o.i. are presented as blue
%    dots. In B we show the LFP traces and their CSD representation for those
%    selected electrodes.
%    In C we shoe the CSDA for various timestamps in the sub-region
%    indicated in A as the r.o.i, which covers a square of 24 by 24 electrodes over CA3.
%    in the first image,  4ms after the stimulus,  a
%    shaded strip indicating the approximate location of str. pyr. A model neuron is
%    drawn for scale. At 4ms after the stimulus, the saturation of the electric shock
%    recedes and we can began to appreciate real neuronal activity on the responsive
%    sector of CA3. A great sink appears over the somatic layer, surrounded by two
%    sources and some smaller patches of activity. At the following frame the patch
%    appears to have moved anterogradly, towards CA1. Next frame, the sink appears
%    to have inverted its polarity as do their surrounding patches, and the movement
%    continues until approximately 9ms after stimulus, where the activity ceases to be
%    discernible from noise.}
%  \label{CSD_Evocada01}
% \end{figure}



%\begin{figure}[h]
% \includegraphics[width=0.9\textwidth]{Figuras/CMVariousTimes01.pdf}
%  \caption{ The CM analysis over the same images as figure \ref{lfpcsdcmsub}. Some trajectories
%    are calculated before the 4ms time stamp. The triangular mark shows the later point of the
%    trajectory, either the end or the last calculated position until that moment. The circular
%    mark is the start of the trajectory. We can see that activity moves form CA3 distal to
%    proximal in alternating waves of action (hiperpolarization, firing and repolarization).
%  }\label{cmevocada}
%\end{figure} 



\begin{figure}[H]
   \captionsetup{singlelinecheck=off} 
 \includegraphics[width=0.7\textwidth]{./Figuras/trayevocadasub.pdf}
 \caption[test]{
   \begin{intension}
     Primera muestra de trayectorias. Escogemos sólo la parte
     respondiente del potencial evocado, para claridad. Se debe
     poder apreciar como las trayectorias corren sobre
     los diferentes estratos y sus tiempos de desplazamiento
     son esperados dentro de las escalas de distancia y sincronización.
   \end{intension}
   The evoked trajectories in the r.o.i. We begin to track them
    at the 0.9 ms mark, after letting the saturation of the stimulus recede.
    At 3ms a very clear sink trajectory is moving retrogradly towards CA2,
    shepherd by two shorter source trajectories. At 5.6 a depolarization
    trajectory starts, following almost the same path and presenting also its
    two companions, ending around the 7.7ms timestamp. No significant
  trajectories are observed after the 10ms mark. }\label{evotracks}
\end{figure}



\subsection{Application to facilitated activity through injury}

A very small transversal cut of the enthorrinal cortex produces
a higher level of activity in the stratyum pyramidale. We call
this ``facilitated activity''. This activity shows bursts that
are very clean in the CSD representation.
\ref{diagfaci}, \ref{lfpcsdcmfaci}, \ref{facitracks} and
\ref{facitracktodas}.
A previous diagram is on the figure \ref{diagfaci}, and some
exemplary traces in the figure \ref{trazfaci}.


\begin{figure}[H]
   \captionsetup{singlelinecheck=off} 
  \includegraphics[width=0.7\textwidth]{Figuras/diagfacilitada.pdf}
  \caption[test]{
  \begin{intension}
    Mostrar un diagrama de los estratos importantes. Se puede incorporar
    a otra figura.
  \end{intension}
  A diagram of the approximate location of the pyramidal and granular strata on the hippocampus slice, during a peak of activity as measured in \muV{}.
  }
  \label{diagfaci}
\end{figure}


\begin{figure}[H]
   \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{Figuras/mapstddfaci.pdf}
        \caption{Location of electrodes}
        \label{maptrazfaci:map}
    \end{subfigure}
    \qquad
    %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. 
      %(or a blank line to force the subfigure onto a new line)
    \begin{subfigure}[t]{0.15\textwidth}
        \includegraphics[width=\textwidth]{Figuras/trazoselectfaci.pdf}
        \caption{Traces}
        \label{maptrazfaci:traz}
    \end{subfigure}
    \caption{
      \begin{intension}
        Mostrar los trazos en variar regiones del hipocampo para
        aclarar el suceso del ataque epiléptico.
      \end{intension} 
      A selection of traces of the recordings for various electrodes.
      In the subfigure \ref{maptrazfaci:map}, the selected electrodes
      are shown against the standard deviation of the recording of the
      potential, which gives a good indication of the more active
      sites, and therefore, of the structure of the hippocampus.
      The electrode labeled ``a'' is over CA3 proximal, on the other
      extreme ``h'' is in the middle of CA1.
    }\label{trazfaci}
\end{figure}


\begin{figure}[H]
   \captionsetup{singlelinecheck=off} 
\includegraphics[width=0.7\textwidth]{Figuras/lfpcsdcm_facilitada.pdf}
\caption[test]{
  \begin{intension}
    Intensión similar a la figura \ref{lfpcsdcmsub}, pero
    usando el área de registro completa. Se muestra la diversidad
    de escalas que abarcan los posibles componentes, por ejemplo,
    los muy grandes en las lineas centrales, en CA3, y los pequeños en
    la cola de CA1 en los últimos renglones. 
  \end{intension}

  Comparison of the activity represented as LFP, CSD and CM,
  in the same style as fig. \ref{lfpcsdcm}, but for facilitated activity.
  In this case the time counter starts at some moment around 80 ms. before the
  onset of the burst of activity.
}\label{lfpcsdcmfaci}
\end{figure}



\begin{figure}[H]
  \captionsetup{singlelinecheck=off}
  \includegraphics[width=0.7\textwidth]{./Figuras/trayfaciljuntas.pdf}
\caption[test]{
  \begin{intension}
    Imagen de área de registro completo mostranto las trayectorias.
    Después de la figura \ref{evotracks}, esta figura muestra
    la riqueza estructural en los datos generados con éste análisis,
    y muestra la posibilidad ( intuitivamente ) de agrupar visualmente
    los diferentes manchones de trayectorias a esta escala. 
  \end{intension}
 The trajectories for  the facilitated activity, in
 sequence of apparition around the burst of action.}\label{facitracks}
\end{figure}



\begin{figure}[H]
   \captionsetup{singlelinecheck=off} 
 \includegraphics[width=0.7\textwidth]{./Figuras/traytodasfacilitada.png}
 \caption[test]{
   \begin{intension}
     Remate de la figura \ref{facitracks}. En la ampliación es mucho más fácil
     discernir diferentes tipos de trayectorias. En CA3 corren a lo largo
     de los estratos, mientras que en CA1 son primordialmente transversales.
     También se puede apreciar un área de transición con menor densidad. 
   \end{intension}
   
 The trajectories for  the facilitated activity, shown
 all together.}\label{facitracktodas}
\end{figure}

%%%% *********** Vas aqui

\subsection{Application to epileptic-like activity in the hippocampus}


This is probably the most complicated data, 
numerically and qualitatively, which comes from a series of epileptic burst
that occurred after 15 minutes of application of 4AP to living slices of
hippocampus. Each burst occurs with activity spreading over many sites almost
simultaneously. This turned out to be a test of the applicability and
robustness of our method.
The necessity of having a good error value for the inactive set was more apparent here
than in the other cases. Also, the most striking features of the propagation of activity,
coded now as trajectories of the CM, could be seen here, as the epileptic burst covered the whole
CA structure. A sample of the raw data in $\muV{}$ can be seen in the figure \ref{lfpycsd4ap}. In the figure \ref{traz4ap} some exemplary traces
can be seen.
Five key moments in the epileptic burst have been selected, one just before the onset of the attack, the next one at the peak and one  following it, and the last at the subsiding moments. The figure compares the Raw data
in $\muV{}$ in the first row, then the raw CSD representation in the second row, and
in the third raw a CSD after a Gaussian Blur Filter has been applied,
with a $\sigma$ value of $ \mum{42}$. After the Gaussian Blur acts a sort of
spatial denoising mechanism, the disjoint components are apparent to the eye.
In the figure \ref{csdfrontera} we separate the disjoint
components. Again, in the first row we have the CSD without the Gaussian Blur.
Even though well localized patches of activity are to be seen over the
stratum pyramidale, large parts of the activity remain hidden by the noise.
After the Gaussian Blur has been applied the joint sets of activity are evident. 

In the figure \ref{tray4ap} we show the epileptic burst on the trajectories representation.
Fine lines
connect the blue (sink) and red (source) dots, that indicate the trajectories
along various activation
sites around the whole CA structure, and part of GD. Very small trajectories precede
the onset of the epileptiform attack in CA1. At around 60ms after the 4AP dose a burst
of localized trajectories appear near CA2. By the 70ms mark, the activity has spread
retrograde through most of the CA structure. Between the 80 and 90 ms marks
GD shows knot-like trajectories. By 140ms the remaining activity is in the proximal
area of CA1.




\begin{figure}[H]
   \captionsetup{singlelinecheck=off} 
  \includegraphics[width=0.9\textwidth]{./Figuras/LFPvsCSD_4AP.pdf}
  \caption[test]
  { \begin{intension}
      En esta figura muestro LFP contra CSD con ruido espacial y
      sin ruido espacial. Esta vez estoy probando ordenar por
      columnas en lugar de por renglones, probando otra representación.
      A diferencia de otras figuras, aquí muestro explicitamente
      la ayuda de usar un filtro gaussiano espacial para
      ``limar el ruido''. 
    \end{intension}
    Comparison of LFP and CSD representations
    at the moments of the epileptic burst. In the first row
    we present the data as measured, no denoising or filtering has
    been applied. The units of measurement are in $\muV{}$. In
    the middle row a direct application of a difference operator
    gives us the CSD. This sort of operators are very sensitive
    to noise, in this case, spatial hard edges, which become
    greatly exaggerated. In the third row we present the same
    data after a Gaussian spatial filter ( Gaussian Blur) has
    been applied. }\label{lfpycsd4ap}
\end{figure}

\begin{figure}[H]
   \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{Figuras/mapstdd4AP.pdf}
        \caption{Location of electrodes}
        \label{maptraz4ap:map}
    \end{subfigure}
    \qquad
    %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. 
      %(or a blank line to force the subfigure onto a new line)
    \begin{subfigure}[t]{0.15\textwidth}
        \includegraphics[width=\textwidth]{Figuras/trazoselect4AP.pdf}
        \caption{Traces}
        \label{maptraz4ap:traz}
    \end{subfigure}
    \caption{
      \begin{intension}
        Mostrar los trazos en variar regiones del hipocampo para
        aclarar el suceso del ataque epiléptico.
      \end{intension} 
      A selection of traces of the recordings for various electrodes.
      In the subfigure \ref{maptraz4ap:map}, the selected electrodes
      are shown against the standard deviation of the recording of the
      potential, which gives a good indication of the more active
      sites, and therefore, of the structure of the hippocampus.
      The electrode labeled ``a'' is putatively over GD, while ``h''
      is in the medial CA1.}\label{traz4ap}
\end{figure}


\begin{figure}[H]
   \captionsetup{singlelinecheck=off} 
  \includegraphics[width=0.9\textwidth]{./Figuras/Fronteras2sigma.pdf}
  \caption[test]
    {
      \begin{intension}
        Una vez más enfatizamos la importancia del filtro gaussiano.
        En el renglón superior mostramos como los componentes disconexos
        quedan demasiado pequeños, y se pierde significancia en un mar de
        ruido, mientras que en el inferior aparecen subconjuntos coherentes.
      \end{intension}

            The detection of disconnected components for the Sink and Source
    Sets. We take the the threshold value as two times the
    standard deviation of the whole data in CSD representation. In
    the upper row the data without the Gaussian Blur filtering is shown.
    Although the location of some of the active sets is clear, a lot of the
    joint activity gets hidden under the spatial noise. In the lower
    row we repeat the detection with the smoothed data. Large, coherent
    patches of activity are clearly shown, and the structure of the
    stratum pyramidale is apparent. 
  }\label{csdfrontera}
\end{figure}


\begin{figure}[H]
   \captionsetup{singlelinecheck=off} 
  \includegraphics[width=0.9\textwidth]{./Figuras/SeqTray4AP01.pdf}
  \caption[test]{
    \begin{intension}
      Partiendo del renglón inferior de la figura \ref{csdfrontera}
      mostramos la aparición y sucesión de trayectorias bien definidas
      sobre str.pyr. y el giro dentado (primer ejemplo donde es claramente
      discernible su aportación a las trayectorias). 
    \end{intension}
    The activity in the Center of Mass and Trajectories representation.
    A single epileptic attack is shown from slightly before the onset until the
    last wave of the attack. Sink and Source trajectories are shown in blue
    and red, respectively. In order to not saturate the latter subfigures
    we take a persistence value of 2 ms, meaning that we do not shown
    trajectories 2 ms after they have ended.}\label{tray4ap}.
 \end{figure}



\subsection{Counterexample: the stratial neuronal tissue}

 Larger scale recordings (macroscopic
structures) may gain something of this analysis, but we shall focus
our result to the neurons scale ( distances of the order of \mum{10}).

The stratial tissue is an example of where this analysis cannot be used.
The limitation of this technique is that it works  in
ordered, stratified neuronal tissue, and highly homogeneous tissue
without clear structures makes the distinction of both the CSD and
disconnected sets unfeasible.


\begin{figure}[H]
 \captionsetup{singlelinecheck=off} 
  \includegraphics[width=0.7\textwidth]{Figuras/lfpestriado.pdf}
  \caption[test]{
    \begin{intension}
      Esta figura contrasta mucho con la figura \ref{lfpevocada}.
      Bajo la misma representación, tenemos muy claro que no hay
      estructuras discernibles. Sin embargo, requiere una serie de trazos
      bien escogidos para saber si hay actividad relevante.
    \end{intension}
    LFP stratial Tissue, some samples. There are no discernible
    structures. The apparent active set at the lower left corner
    is an artifact due to some bubbles in the experiment.}
  \label{cuadestriado}
\end{figure}


%\begin{figure}[H]
%   \centering
%    \begin{subfigure}[b]{0.55\textwidth}
%        \includegraphics[width=\textwidth]{Figuras/mapestriado_1004AP.pdf}
%        \caption{A Frame}
%        \label{maptraz:map}
%    \end{subfigure}
    ~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. 
      %(or a blank line to force the subfigure onto a new line)
%    \begin{subfigure}[b]{0.35\textwidth}
%        \includegraphics[width=\textwidth]{Figuras/trazosestriado_1004AP.pdf}
%        \caption{Traces}
%        \label{maptraz:traz}
%    \end{subfigure}
%    \caption{
%      \begin{intension}
%        Mostramos aquí unos trazos ejemplares para asegurarnos de la
%        calidad del experimento.
%      \end{intension}
%      Selected Traces of the Stratial Tissue. A frame such as the ones
%      in figure \ref{cuadestriado} shows the location of the selected electrodes,
%    which where algorhytmically chosen.}
  
% \end{figure}

\begin{figure}[H]
   \captionsetup{singlelinecheck=off} 
  \includegraphics[width=0.7\textwidth]{Figuras/traytodasestriado.pdf}
  \caption[test]{
    \begin{intension}
      Una muestra clara de que el tejido estriado no
      permite la búsqueda de trayectorias definidas. A pesar
      de contar con un registro mucho más amplio, apenas alcanzamos a
      ver un par de trayectorias ``fuente'' en lo que aparente ser
      un artefacto del ruido y no cuentan con ``pozos'' que acompañen.
    \end{intension}
    After 30 seconds of recording, no visible trajectories can be found. The minimum displacement criteria is not full-filed for most of the putative centers of mass. Only a small set of trajectories is seen on the lower corner and these seem to correspond to an artifact due to a bubble in the recording. }
  
\end{figure}


\section{Conclusions}

We have presented here a numerical tool that can help neurophysiologist in
discovering functional connections in structured tissue. In a previous work
we have shown an example with interpretation \cite{Franco2018}.
In this technical report we have shown in detail the process and ideas
that support it but without much physiological interpretation.
The main idea is to be able to track reliably and somewhat easily
the succession of active sites in the neuronal tissue. It may be that the best
examples are those that have epileptic bursts or some
sort of induced excess activity. In tissue that is highly homogeneous,
or unstructured, this technique is useless. Also, if the activity is
subtle, or shows very reduced local correlation, as opposed to long
range spatial correlations, the analysis may prove not very useful.
The sink and sources trajectories has to be made by the activation
of neighbouring units to make sense. The plausible explanation for these
active neighbours would be that they correspond to the same processing
circuitry, and thus, the trajectory would reveal its existence and
possible some of the simplified pathways that it contains.
It is pertain to remind that those trajectories are not
connections themselves. They are indicators of highly correlated
activity as measured from the outside of the cells. This correlation is
both temporal, spatial, and causal, so it is a good indicator
of possible physiological connection, but it doesn't say of what type it
is or if it direct or indirect.

We may point out some possible uses for this analysis.
If somewhat less noisy electrodes are developed, and their density
increases by a factor of two or four, a very precise mapping of the
trajectories, in conjunction with an ICA, would reveal active
cells that form part of the same functional circuitry. Different
kinds of connections could be revealed by using some blocking
or stimulating drugs, and comparing trajectories.

I would very much suggest a similar analysis done on
the visual cortex by exposition to visual imaginary
that has softly moving stimulus.

Three Dimensional MEAS are becoming also a reality.
In structured tissue, this kind
of analysis would be very revealing, if the electrodes
are dense enough, we may be able to trace the different units at
different strata stimulated by a single axon.




\bibliographystyle{abstract}
\bibliography{../Reportes/BiblioReportes01} 



\end{document}


